<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragomir's Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Use a consistent key for localStorage
        const STORAGE_KEY = 'workout_tracker_data';

        // --- Date and UI Generation Logic ---
        function getRecentDates(count) {
            const dates = [];
            for (let i = 0; i < count; i++) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                dates.push(d);
            }
            return dates.reverse(); // Show oldest to newest
        }

        function getFormattedDate(date) {
            return date.toISOString().split('T')[0];
        }

        function getWeekday(date) {
            return date.toLocaleDateString('en-US', { weekday: 'short' });
        }

        function calculateStreak(workouts) {
            if (Object.keys(workouts).length === 0) return 0;

            const today = new Date();
            let streakEndDay = new Date(today);
            let currentStreak = 0;

            let streakInProgress = true;
            while(streakInProgress) {
                const formattedDate = getFormattedDate(streakEndDay);
                if (workouts[formattedDate]) {
                    currentStreak++;
                    streakEndDay.setDate(streakEndDay.getDate() - 1);
                } else {
                    streakInProgress = false;
                }
            }

            return currentStreak;
        }

        // --- Data Handling with localStorage ---
        function loadData() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : {};
            } catch (e) {
                console.error("Error loading data from localStorage:", e);
                return {};
            }
        }

        function saveData(data) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                updateUI();
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
            }
        }
        
        // --- Core UI Rendering and Event Handling ---
        function updateUI() {
            const daysContainer = document.getElementById('days-container');
            const storedWorkouts = loadData();
            const dates = getRecentDates(5);
            
            daysContainer.innerHTML = ''; // Clear to prevent duplicates

            dates.forEach(date => {
                const formattedDate = getFormattedDate(date);
                const workedOut = storedWorkouts[formattedDate] || false;
                
                const dayCard = document.createElement('div');
                dayCard.className = 'flex flex-col items-center p-6 bg-slate-800 rounded-xl shadow-lg hover:bg-slate-700 transition-colors duration-200 cursor-pointer';
                
                const dayLabel = document.createElement('span');
                dayLabel.className = 'text-lg font-semibold text-slate-300';
                dayLabel.textContent = getWeekday(date);

                const dateLabel = document.createElement('span');
                dateLabel.className = 'text-sm text-slate-500 mt-1';
                dateLabel.textContent = formattedDate;

                const checkboxContainer = document.createElement('label');
                checkboxContainer.className = 'flex items-center justify-center mt-4 cursor-pointer';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'hidden';
                checkbox.checked = workedOut;

                const customCheckbox = document.createElement('div');
                customCheckbox.className = `w-8 h-8 rounded-full border-2 border-slate-600 transition-all duration-300 flex items-center justify-center ${workedOut ? 'bg-emerald-500 border-emerald-500 scale-110' : 'bg-slate-700'}`;
                customCheckbox.innerHTML = `
                    <svg class="w-5 h-5 text-white transition-opacity duration-300 ${workedOut ? 'opacity-100' : 'opacity-0'}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"></path>
                    </svg>
                `;

                // Add event listener to handle changes
                checkbox.addEventListener('change', () => {
                    const updatedWorkouts = loadData();
                    updatedWorkouts[formattedDate] = checkbox.checked;
                    saveData(updatedWorkouts);
                });

                checkboxContainer.appendChild(checkbox);
                checkboxContainer.appendChild(customCheckbox);
                
                dayCard.appendChild(dayLabel);
                dayCard.appendChild(dateLabel);
                dayCard.appendChild(checkboxContainer);
                daysContainer.appendChild(dayCard);
            });
            
            const currentStreak = calculateStreak(storedWorkouts);
            document.getElementById('streak-count').textContent = currentStreak;
        }

        // Initialize UI on window load
        window.onload = () => {
            const loading = document.getElementById('loading');
            if (loading) loading.style.display = 'none';
            updateUI();
        };
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #111827;
            background-image: repeating-linear-gradient(45deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.05) 1px, transparent 1px, transparent 10px);
        }
        
        input[type="checkbox"]:checked + div > svg {
            opacity: 1 !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="text-white min-h-screen flex items-center justify-center p-4">
    <div id="loading" class="text-xl text-slate-400">Loading and authenticating...</div>

    <!-- Message Box -->
    <div id="message-box" class="fixed top-5 left-1/2 -translate-x-1/2 p-4 bg-red-600 text-white rounded-lg shadow-lg hidden z-50"></div>

    <div class="w-full max-w-2xl mx-auto bg-slate-900 bg-opacity-80 backdrop-blur-md rounded-2xl shadow-2xl p-6 md:p-10 flex flex-col items-center space-y-8 fade-in">
        <div class="flex flex-col items-center">
            <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-center text-white">Dragomir's Workout Tracker</h1>
            <p class="text-sm text-slate-400 text-center mt-2">Check off each day you worked out to track your progress.</p>
        </div>

        <div class="w-full text-center">
            <div id="streak-display" class="p-4 bg-slate-800 rounded-full shadow-inner inline-flex items-center space-x-2">
                <span class="text-xl font-bold">ðŸ”¥</span>
                <span id="streak-count" class="text-3xl font-bold text-emerald-400">0</span>
                <span class="text-lg text-slate-300">day streak</span>
            </div>
        </div>

        <div id="days-container" class="w-full grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
            <!-- Day cards will be inserted here by JavaScript -->
        </div>
    </div>
</body>
</html>
